<head>
    <style>
        canvas {
            border: 1px solid #333;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <p id="order-display">Order of Hilbert Curve: 1</p>
    <button class="btn" onclick="prev()">Previous</button>
    <button class="btn" onclick="redraw()">Redraw</button>
    <button class="btn" onclick="next()">Next</button>

    <script>
        let screen_width = window.innerWidth, screen_height = window.innerHeight;
        let fps = 24;
        let canvas = document.getElementById("canvas");
        let context = canvas.getContext("2d");
        let order_display = document.getElementById("order-display");

        // Parameters for Hilbert curve
        let order, num_points, counter, speed, res, translate, hue_start;

        // Set initial canvas size
        let canvas_width = 0.45 * screen_width;
        let canvas_height = canvas_width;
        canvas.width = canvas_width;
        canvas.height = canvas_height;

        // Animation setup
        let animate = window.requestAnimationFrame
            || window.webkitRequestAnimationFrame
            || window.mozRequestAnimationFrame
            || function(callback) {
                window.setTimeout(callback, 1000 / fps);
            };

        window.onload = function() {
            initParams();
            animate(step);
        };

        window.onresize = function() {
            screen_width = window.innerWidth;
            screen_height = window.innerHeight;
            canvas_width = 0.45 * screen_width;
            canvas_height = canvas_width;
            canvas.width = canvas_width;
            canvas.height = canvas_height;
            redraw();
        };

        function step() {
            update();
            render();
            animate(step);
        }

        function prev() {
            order = Math.max(1, order - 1);
            order_display.innerText = `Order of Hilbert Curve: ${order}`;
            initialise();
        }

        function next() {
            order++;
            order_display.innerText = `Order of Hilbert Curve: ${order}`;
            initialise();
        }

        function redraw() {
            initialise();
        }

        // Hilbert curve functions
        function update() {}

        function render() {
            let point1, point2, hue;
            for (let i = 0; i < speed && counter < num_points; i++, counter++) {
                hue = hue_start + (counter * 255) / num_points;
                if (hue > 255) {
                    hue_start -= 255;
                }
                point1 = getPoint(counter - 1);
                point2 = getPoint(counter);
                context.strokeStyle = `hsl(${hue}, 50%, 50%)`;
                context.beginPath();
                context.moveTo(point1.x, point1.y);
                context.lineTo(point2.x, point2.y);
                context.stroke();
            }
        }

        function getPoint(index) {
            let vector;
            let primary_index = index & 3;
            switch (primary_index) {
                case 0: vector = { x: 0, y: 0 }; break;
                case 1: vector = { x: 0, y: 1 }; break;
                case 2: vector = { x: 1, y: 1 }; break;
                case 3: vector = { x: 1, y: 0 }; break;
            }

            let temp, secondary_index, shift;
            for (let iteration = 1; iteration < order; iteration++) {
                index = index >> 2;
                secondary_index = index & 3;
                shift = Math.pow(2, iteration);
                switch (secondary_index) {
                    case 0:
                        temp = vector.x;
                        vector.x = vector.y;
                        vector.y = temp;
                        break;
                    case 1:
                        vector.y += shift;
                        break;
                    case 2:
                        vector.x += shift;
                        vector.y += shift;
                        break;
                    case 3:
                        temp = shift - 1 - vector.x;
                        vector.x = shift - 1 - vector.y;
                        vector.y = temp;
                        vector.x += shift;
                        break;
                }
            }

            vector.x *= res;
            vector.x += translate;
            vector.y *= res;
            vector.y += translate;
            return vector;
        }

        function initParams() {
            order = 6;
            initialise();
        }

        function initialise() {
            res = canvas_width / Math.pow(2, order);
            num_points = Math.pow(4, order);
            translate = res / 2;
            hue_start = Math.random() * 255;

            if (order <= 4) speed = Math.pow(2, order);
            else if (order <= 8) speed = Math.pow(2, order + 1);
            else if (order <= 12) speed = Math.pow(2, order + 2);
            else if (order <= 16) speed = Math.pow(2, order + 3);

            counter = 1;
            context.fillStyle = "#000000";
            context.fillRect(0, 0, canvas_width, canvas_height);
            order_display.innerHTML = `Order of Hilbert Curve: ${order}`;
        }
    </script>
</body>
</html>
