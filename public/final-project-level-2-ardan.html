<!DOCTYPE html>
<html lang="en">

<head>
    <title>Final Project Level 2</title>
    <style>
        body {
            background-image: url('background1.jpg');
            background-repeat: repeat;
            background-size: 80%;
            margin: 0;
            overflow: hidden;
        }

        h1 {
            text-align: center;
        }

        canvas {
            display: block;
            margin: auto;
            border: 1px solid black;
        }

        div#gameOverDiv {
            width: 800px;
            height: 500px;
            border: 10px solid black;
            border-radius: 50px;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            margin: auto;
            display: none;
            background-color: rgb(144, 238, 167);
        }

        input#playAgain {
            width: fit-content;
            height: fit-content;
            font-size: xx-large;
            border: 5px solid black;
            border-radius: 15px;
            position: absolute;
            margin: auto;
            left: 0;
            right: 0;
            background-color: rgb(238, 150, 144);
        }
    </style>
</head>

<body>
    <h1>Final Project Level 2</h1>
    <div id="gameOverDiv">
        <h1 id="winnerText" style="font-size: 50px;">Playe1 (great dane) Wins</h1>
        <input type="button" onclick="location.reload()" value="Play Again" id="playAgain">
    </div>
    <canvas id="gameCanvas" width="1200" height="800" style="background-color: white;"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');


        // Load images for player 1
        const player1Default = new Image();
        player1Default.src = 'finalProjectImages/player1.png';

        const player1Frozen = new Image();
        player1Frozen.src = 'finalProjectImages/player1Frozen.png';

        const player1Stunned = new Image();
        player1Stunned.src = 'finalProjectImages/player1Stunned.png';

        const player1AttackFrozen = new Image();
        player1AttackFrozen.src = 'finalProjectImages/player1AttackFrozen.png';

        const player1Airborne = new Image();
        player1Airborne.src = 'finalProjectImages/player1Airborne.png';

        const player1groundLightAttacking = new Image();
        player1groundLightAttacking.src = 'finalProjectImages/player1groundLightAttacking.png';

        const player1groundHeavyAttacking = new Image();
        player1groundHeavyAttacking.src = 'finalProjectImages/player1groundHeavyAttacking.png';

        const player1groundUpAttacking = new Image();
        player1groundUpAttacking.src = 'finalProjectImages/player1groundUpAttacking.png';

        const player1groundSmashAttacking = new Image();
        player1groundSmashAttacking.src = 'finalProjectImages/player1groundSmashAttacking.png';

        const player1airLightAttacking = new Image();
        player1airLightAttacking.src = 'finalProjectImages/player1airLightAttacking.png';

        const player1airHeavyAttacking = new Image();
        player1airHeavyAttacking.src = 'finalProjectImages/player1airHeavyAttacking.png';

        const player1airUpAttacking = new Image();
        player1airUpAttacking.src = 'finalProjectImages/player1airUpAttacking.png';

        const player1airSmashAttacking = new Image();
        player1airSmashAttacking.src = 'finalProjectImages/player1airSmashAttacking.png';

        const player1groundLightWindup = new Image();
        player1groundLightWindup.src = 'finalProjectImages/player1groundLightWindup.png';

        const player1groundHeavyWindup = new Image();
        player1groundHeavyWindup.src = 'finalProjectImages/player1groundHeavyWindup.png';

        const player1groundUpWindup = new Image();
        player1groundUpWindup.src = 'finalProjectImages/player1groundUpWindup.png';

        const player1groundSmashWindup = new Image();
        player1groundSmashWindup.src = 'finalProjectImages/player1groundSmashWindup.png';

        const player1airLightWindup = new Image();
        player1airLightWindup.src = 'finalProjectImages/player1airLightWindup.png';

        const player1airHeavyWindup = new Image();
        player1airHeavyWindup.src = 'finalProjectImages/player1airHeavyWindup.png';

        const player1airUpWindup = new Image();
        player1airUpWindup.src = 'finalProjectImages/player1airUpWindup.png';

        const player1airSmashWindup = new Image();
        player1airSmashWindup.src = 'finalProjectImages/player1airSmashWindup.png';

        // Load images for player 2
        const player2Default = new Image();
        player2Default.src = 'finalProjectImages/player2.png';

        const player2Frozen = new Image();
        player2Frozen.src = 'finalProjectImages/player2Frozen.png';

        const player2Stunned = new Image();
        player2Stunned.src = 'finalProjectImages/player2Stunned.png';

        const player2AttackFrozen = new Image();
        player2AttackFrozen.src = 'finalProjectImages/player2AttackFrozen.png';

        const player2Airborne = new Image();
        player2Airborne.src = 'finalProjectImages/player2Airborne.png';

        const player2groundLightAttacking = new Image();
        player2groundLightAttacking.src = 'finalProjectImages/player2groundLightAttacking.png';

        const player2groundHeavyAttacking = new Image();
        player2groundHeavyAttacking.src = 'finalProjectImages/player2groundHeavyAttacking.png';

        const player2groundUpAttacking = new Image();
        player2groundUpAttacking.src = 'finalProjectImages/player2groundUpAttacking.png';

        const player2groundSmashAttacking = new Image();
        player2groundSmashAttacking.src = 'finalProjectImages/player2groundSmashAttacking.png';

        const player2airLightAttacking = new Image();
        player2airLightAttacking.src = 'finalProjectImages/player2airLightAttacking.png';

        const player2airHeavyAttacking = new Image();
        player2airHeavyAttacking.src = 'finalProjectImages/player2airHeavyAttacking.png';

        const player2airUpAttacking = new Image();
        player2airUpAttacking.src = 'finalProjectImages/player2airUpAttacking.png';

        const player2airSmashAttacking = new Image();
        player2airSmashAttacking.src = 'finalProjectImages/player2airSmashAttacking.png';

        const player2groundLightWindup = new Image();
        player2groundLightWindup.src = 'finalProjectImages/player2groundLightWindup.png';

        const player2groundHeavyWindup = new Image();
        player2groundHeavyWindup.src = 'finalProjectImages/player2groundHeavyWindup.png';

        const player2groundUpWindup = new Image();
        player2groundUpWindup.src = 'finalProjectImages/player2groundUpWindup.png';

        const player2groundSmashWindup = new Image();
        player2groundSmashWindup.src = 'finalProjectImages/player2groundSmashWindup.png';

        const player2airLightWindup = new Image();
        player2airLightWindup.src = 'finalProjectImages/player2airLightWindup.png';

        const player2airHeavyWindup = new Image();
        player2airHeavyWindup.src = 'finalProjectImages/player2airHeavyWindup.png';

        const player2airUpWindup = new Image();
        player2airUpWindup.src = 'finalProjectImages/player2airUpWindup.png';

        const player2airSmashWindup = new Image();
        player2airSmashWindup.src = 'finalProjectImages/player2airSmashWindup.png';


        // movement variables
        const gravity = 0.7;
        const jumpStrength = -17;
        const acceleration = 1.5;
        const maxSpeed = 8;
        const deceleration = 0.6;
        let attack1Hitbox = null;
        let attack2Hitbox = null;

        // Player properties
        const player1 = {
            x: 50,
            y: canvas.height - 80,
            width: 80,
            height: 80,
            image: player1Default, //image source for player
            velocity: { x: 0, y: 0 },
            health: 100,
            jumpCount: 0,
            lastAttackTime: {},
            isAirborne: false, //if in the air
            flipped: false, //so drawplayer knows what direction to face the player and what direction attacks come from
            isAttacking: false, //if the attack is actively coming out of the player
            isAttackFrozen: false, //freezes player the instant they attack lasts till the end of the attack cooldown
            isFrozen: false, //freezes movement when player is attacked
            hasHit: false, //triggered when player gets hit ended when attack ends to make the same attack not hit every frame
            isStunned: false, //triggered in stunAnimate to prevent player from moving during knockback checked by undatePlayer
            isWindup: false, //not functional just for animations to telegraph an attack is coming
            currentAttackType: 'default', //what attack type player is using only checked attack is triggered
        };
        const player2 = {
            x: 1070,
            y: canvas.height - 80,
            width: 80,
            height: 80,
            image: player2Default, //image source for player
            velocity: { x: 0, y: 0 },
            health: 100,
            jumpCount: 0,
            lastAttackTime: {},
            isAirborne: false, //if in the air
            flipped: false, //so drawplayer knows what direction to face the player and what direction attacks come from
            isAttacking: false, //if the attack is actively coming out of the player
            isAttackFrozen: false, //freezes player the instant they attack lasts till the end of the attack cooldown
            isFrozen: false, //freezes movement when player is attacked
            hasHit: false, //triggered when player gets hit ended when attack ends to make the same attack not hit every frame
            isStunned: false, //triggered in stunAnimate to prevent player from moving during knockback checked by undatePlayer
            isWindup: false, //not functional just for animations to telegraph an attack is coming
            currentAttackType: 'default', //what attack type player is using only checked attack is triggered
        };
        // Attack types
        const attackConfigs = {
            groundLight: { width: 70, height: 25, knockback: 15, knockbackY: 4, damage: 5, startup: 100, duration: 100, cooldown: 150, freezeTime: 500, instantknockbackX: 20, instantknockbackY: 15, offsetX: 0, offsetY: 40, knockbackDuration: 0, },
            groundHeavy: { width: 100, height: 40, knockback: 25, knockbackY: 5, damage: 20, startup: 250, duration: 250, cooldown: 450, freezeTime: 400, instantknockbackX: 0, instantknockbackY: 0, offsetX: 0, offsetY: 25, knockbackDuration: 250, },
            groundUp: { width: 70, height: 70, knockback: 5, knockbackY: 20, damage: 15, startup: 275, duration: 100, cooldown: 450, freezeTime: 350, instantknockbackX: 5, instantknockbackY: 15, offsetX: -40, offsetY: 110, knockbackDurationad: 25, },
            groundSmash: { width: 120, height: 110, knockback: 16, knockbackY: 17, damage: 25, startup: 300, duration: 200, cooldown: 400, freezeTime: 500, instantknockbackX: 10, instantknockbackY: 10, offsetX: -80, offsetY: 0, knockbackDuration: 300, },
            airLight: { width: 80, height: 40, knockback: 15, knockbackY: 5, damage: 10, startup: 125, duration: 150, cooldown: 225, freezeTime: 500, instantknockbackX: 15, instantknockbackY: 15, offsetX: 0, offsetY: 50, knockbackDuration: 100, },
            airHeavy: { width: 100, height: 60, knockback: 21, knockbackY: -2, damage: 20, startup: 250, duration: 250, cooldown: 450, freezeTime: 400, instantknockbackX: 25, instantknockbackY: 0, offsetX: 0, offsetY: -25, knockbackDuration: 250, },
            airUp: { width: 50, height: 60, knockback: 5, knockbackY: 16, damage: 10, startup: 125, duration: 75, cooldown: 200, freezeTime: 350, instantknockbackX: 0, instantknockbackY: 15, offsetX: -25, offsetY: 95, knockbackDurationad: 10, },
            airSmash: { width: 40, height: 55, knockback: 10, knockbackY: 2, damage: 10, startup: 125, duration: 150, cooldown: 250, freezeTime: 500, instantknockbackX: 0, instantknockbackY: 0, offsetX: -25, offsetY: -65, knockbackDuration: 60, },
        };


        // Event listeners for jump attacks and keys
        window.addEventListener('keydown', (event) => {
            keys[event.key] = true;

            if (event.key === 'Tab') {
                event.preventDefault(); // Prevent default tab behavior (e.g., switching focus)
                console.log(player1, player2);
            }

            if (event.key === 'w') handleJump(player1);
            if (event.key === 'ArrowUp') handleJump(player2);

            // Player 1 attacks
            if (event.key === ' ') {
                let attackType;
                if (player1.isAirborne == true) {
                    if ((keys['a'] || keys['d']) && keys['s']) { // No directional keys pressed
                        attackType = 'airHeavy';
                    } else if (keys['s']) {
                        attackType = 'airSmash';
                    } else if (keys['a'] || keys['d']) {
                        attackType = 'airLight';
                    } else {
                        attackType = 'airUp';
                    }
                } else {
                    if ((keys['a'] || keys['d']) && keys['s']) { // No directional keys pressed
                        attackType = 'groundHeavy';
                    } else if (keys['s']) {
                        attackType = 'groundSmash';
                    } else if (keys['a'] || keys['d']) {
                        attackType = 'groundLight';
                    } else {
                        attackType = 'groundUp';
                    }
                }
                performAttack(player1, attackType);
            }
        });

        window.addEventListener('mousedown', (event) => {
            event.preventDefault();
            let attackType;
            if (player2.isAirborne == true) {
                if ((keys['ArrowLeft'] || keys['ArrowRight']) && keys['ArrowDown']) {
                    attackType = 'airHeavy';
                } else if (keys['ArrowDown']) {
                    attackType = 'airSmash';
                } else if (keys['ArrowLeft'] || keys['ArrowRight']) { // No directional keys pressed
                    attackType = 'airLight';
                } else {
                    attackType = 'airUp';
                }
            } else {
                if ((keys['ArrowLeft'] || keys['ArrowRight']) && keys['ArrowDown']) {
                    attackType = 'groundHeavy';
                } else if (keys['ArrowDown']) {
                    attackType = 'groundSmash';
                } else if (keys['ArrowLeft'] || keys['ArrowRight']) { // No directional keys pressed
                    attackType = 'groundLight';
                } else {
                    attackType = 'groundUp';
                }
            }

            performAttack(player2, attackType);
        });

        window.addEventListener('keyup', (event) => {
            keys[event.key] = false;
        });

        // key states
        const keys = {
            w: false, a: false, s: false, d: false,
            ArrowUp: false, ArrowLeft: false, ArrowDown: false, ArrowRight: false
        };

        // checks if player is able to jump then sets y velocity (triggered when event listener for up goes off)
        function handleJump(player) {
            if (player.isFrozen || player.isStunned) return;

            if (player.jumpCount < 2) { // Allow up to 2 jumps
                player.velocity.y = jumpStrength;
                player.jumpCount++;
                player.isAirborne = true;
            }
        }

        // first thing thats runs when you attack. starts the attackanimate and cooldown
        function performAttack(player, attackType = 'default') {
            if (player.isAttackFrozen || player.isFrozen) return;

            const attackConfig = attackConfigs[attackType];
            if (!attackConfig) return;

            // Ensure lastAttackTime exists for this attack type
            if (!player.lastAttackTime[attackType]) {
                player.lastAttackTime[attackType] = 0;
            }

            const currentTime = Date.now();
            const timeSinceLastAttack = currentTime - player.lastAttackTime[attackType];

            // Prevent attack if less than 1 second has passed since last use of this attack type
            if (timeSinceLastAttack < 1000) {
                console.log(`Attack ${attackType} on cooldown for player.`);
                return;
            }

            // Update lastAttackTime for the attack type
            player.lastAttackTime[attackType] = currentTime;

            player.currentAttackType = attackType; // Set the current attack type

            attackAnimate(player, attackConfig);
        }


        // handles functionality of attack. changes states for each part of attacj (called by performAttack)
        function attackAnimate(player, attackConfig, target) {
            player.isAttackFrozen = true; // Freeze the attacking player
            let currentHitbox = null;
            player.isWindup = true;

            setTimeout(() => {
                player.isAttacking = true; // Start attack animation
                player.isWindup = false;
                currentHitbox = player === player1 ? attack1Hitbox : attack2Hitbox;
                setTimeout(() => {
                    player.isAttacking = false; // End attack animation
                    // Now set the hasHit flag of the *target* player (the player being attacked)
                    if (player === player1) {
                        player2.hasHit = false; // Reset hasHit flag for player2 (target)
                    } else {
                        player1.hasHit = false; // Reset hasHit flag for player1 (target)
                    }
                    currentHitbox = null; // Clear the hitbox after attack
                    setTimeout(() => {
                        player.isAttackFrozen = false; // Unfreeze the player
                    }, attackConfig.cooldown); // Cooldown
                }, attackConfig.duration); // Attack duration
            }, attackConfig.startup); // Delay before attack starts
        }


        // freezes player and sets timer to unfreeze player (called from animate when player is hit)
        function stunAnimate(player, attacker, attackConfig) {
            // Reduce health based on attack damage
            player.health -= attackConfig.damage;
            player.hasHit = true; // Mark player as hit

            // Cancel attack if the player is currently attacking or attack-frozen
            if (player.isAttackFrozen) {
                player.isAttacking = false;    // Stop the attack animation
                player.isAttackFrozen = false; // Prevent the attack from starting
                player.canAttack = true;      // Reset the attack cooldown
            }

            // Apply knockback immediately
            player.velocity.x = attacker.x < player.x ? attackConfig.knockback : -attackConfig.knockback;
            player.velocity.y = -attackConfig.knockbackY;

            player.x += attacker.x < player.x ? attackConfig.instantknockbackX : -attackConfig.instantknockbackX;;
            player.y += -attackConfig.instantknockbackY;

            // Prevent falling off canvas
            if (player.y > canvas.height - player.height) {
                player.y = canvas.height - player.height;
                player.velocity.y = 0;
                player.jumpCount = 0;
            }

            // If already stunned, clear previous timers and reset
            if (player.freezeTimeout) {
                clearTimeout(player.freezeTimeout);
            }

            player.isFrozen = true;
            player.freezeTimeout = setTimeout(() => {
                player.isFrozen = false; // Unfreeze the player
                player.isStunned = true;
                setTimeout(() => {
                    player.isStunned = false; // Re-enable movement
                }, attackConfig.knockbackDuration);
            }, attackConfig.freezeTime);

            player.x = Math.max(0, Math.min(player.x, canvas.width - player.width));
        }


        // ellis code to check collision between attack and player (called by animate)
        function checkAttackCollision(attack, target) {
            return (
                attack.x < target.x + target.width &&
                attack.x + attack.width > target.x &&
                attack.y < target.y + target.height &&
                attack.y + attack.height > target.y
            );
        }


        // calculates players speed and other values called by animate
        function updatePlayer(player, keysLeft, keysRight) {
            if (player.isFrozen) return; // Skip updates if the player is frozen

            // Apply gravity
            player.velocity.y += gravity;

            // Horizontal movement
            if (!player.isStunned) {
                if (keys[keysLeft]) {
                    player.velocity.x = Math.max(player.velocity.x - acceleration, -maxSpeed);
                    player.flipped = false;
                } else if (keys[keysRight]) {
                    player.velocity.x = Math.min(player.velocity.x + acceleration, maxSpeed);
                    player.flipped = true;
                }
            }

            // Deceleration
            player.velocity.x = Math.abs(player.velocity.x) < deceleration
                ? 0
                : player.velocity.x - Math.sign(player.velocity.x) * deceleration;

            // Update positions
            player.x += player.velocity.x;
            player.y += player.velocity.y;

            player.isAirborne = true;
            // Prevent falling off canvas
            if (player.y > canvas.height - player.height) {
                player.y = canvas.height - player.height;
                player.velocity.y = 0;
                player.jumpCount = 0;
                player.isAirborne = false;
            }
            else {
                player.isAirborne = true;
            }

            // Prevent moving out of bounds
            player.x = Math.max(0, Math.min(player.x, canvas.width - player.width));
        }


        function updateImage(player, attack) {
            if (player === player1) { // Use === for comparison
                if (player.isFrozen) {
                    player.image = player1Frozen;
                } else if (player.isStunned) {
                    player.image = player1Stunned;
                } else if (player.isAttacking) {
                    if (attack === attackConfigs.groundLight) {
                        player.image = player1groundLightAttacking;
                    } else if (attack === attackConfigs.groundHeavy) {
                        player.image = player1groundHeavyAttacking;
                    } else if (attack === attackConfigs.groundUp) {
                        player.image = player1groundUpAttacking;
                    } else if (attack === attackConfigs.groundSmash) {
                        player.image = player1groundSmashAttacking;
                    } else if (attack === attackConfigs.airLight) {
                        player.image = player1airLightAttacking;
                    } else if (attack === attackConfigs.airHeavy) {
                        player.image = player1airHeavyAttacking;
                    } else if (attack === attackConfigs.airUp) {
                        player.image = player1airUpAttacking;
                    } else if (attack === attackConfigs.airSmash) {
                        player.image = player1airSmashAttacking;
                    }
                } else if (player.isWindup) {
                    if (attack === attackConfigs.groundLight) {
                        player.image = player1groundLightWindup;
                    } else if (attack === attackConfigs.groundHeavy) {
                        player.image = player1groundHeavyWindup;
                    } else if (attack === attackConfigs.groundUp) {
                        player.image = player1groundUpWindup;
                    } else if (attack === attackConfigs.groundSmash) {
                        player.image = player1groundSmashWindup;
                    } else if (attack === attackConfigs.airLight) {
                        player.image = player1airLightWindup;
                    } else if (attack === attackConfigs.airHeavy) {
                        player.image = player1airHeavyWindup;
                    } else if (attack === attackConfigs.airUp) {
                        player.image = player1airUpWindup;
                    } else if (attack === attackConfigs.airSmash) {
                        player.image = player1airSmashWindup;
                    }
                } else if (player.isAttackFrozen) {
                    player.image = player1AttackFrozen;
                } else if (player.isJumping) {
                    player.image = player1Airborne;
                } else {
                    player.image = player1Default;
                }
            }
            if (player === player2) { // Use === for comparison
                if (player.isFrozen) {
                    player.image = player2Frozen;
                } else if (player.isStunned) {
                    player.image = player2Stunned;
                } else if (player.isAttacking) {
                    if (attack === attackConfigs.groundLight) {
                        player.image = player2groundLightAttacking;
                    } else if (attack === attackConfigs.groundHeavy) {
                        player.image = player2groundHeavyAttacking;
                    } else if (attack === attackConfigs.groundUp) {
                        player.image = player2groundUpAttacking;
                    } else if (attack === attackConfigs.groundSmash) {
                        player.image = player2groundSmashAttacking;
                    } else if (attack === attackConfigs.airLight) {
                        player.image = player2airLightAttacking;
                    } else if (attack === attackConfigs.airHeavy) {
                        player.image = player2airHeavyAttacking;
                    } else if (attack === attackConfigs.airUp) {
                        player.image = player2airUpAttacking;
                    } else if (attack === attackConfigs.airSmash) {
                        player.image = player2airSmashAttacking;
                    }
                } else if (player.isWindup) {
                    if (attack === attackConfigs.groundLight) {
                        player.image = player2groundLightWindup;
                    } else if (attack === attackConfigs.groundHeavy) {
                        player.image = player2groundHeavyWindup;
                    } else if (attack === attackConfigs.groundUp) {
                        player.image = player2groundUpWindup;
                    } else if (attack === attackConfigs.groundSmash) {
                        player.image = player2groundSmashWindup;
                    } else if (attack === attackConfigs.airLight) {
                        player.image = player2airLightWindup;
                    } else if (attack === attackConfigs.airHeavy) {
                        player.image = player2airHeavyWindup;
                    } else if (attack === attackConfigs.airUp) {
                        player.image = player2airUpWindup;
                    } else if (attack === attackConfigs.airSmash) {
                        player.image = player2airSmashWindup;
                    }
                } else if (player.isAttackFrozen) {
                    player.image = player2AttackFrozen;
                } else if (player.isJumping) {
                    player.image = player2Airborne;
                } else {
                    player.image = player2Default;
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            updateImage(player1, attackConfigs[player1.currentAttackType])
            updateImage(player2, attackConfigs[player2.currentAttackType])

            // Update player positions
            if (!player1.isAttackFrozen)
                updatePlayer(player1, 'a', 'd');
            if (!player2.isAttackFrozen)
                updatePlayer(player2, 'ArrowLeft', 'ArrowRight');

            // Draw players
            drawPlayer(player1);
            drawPlayer(player2);

            // Draw attacks
            if (player1.isAttacking && player1.isAttackFrozen) {
                attack1Hitbox = drawAttack(player1, attackConfigs[player1.currentAttackType]);
            } else {
                attack1Hitbox = null; // Clear hitbox if not attacking
            }

            if (player2.isAttacking && player2.isAttackFrozen) {
                attack2Hitbox = drawAttack(player2, attackConfigs[player2.currentAttackType]);
            } else {
                attack2Hitbox = null; // Clear hitbox if not attacking
            }

            // Check for attack collisions
            const player1HitPlayer2 = attack1Hitbox && checkAttackCollision(attack1Hitbox, player2);
            const player2HitPlayer1 = attack2Hitbox && checkAttackCollision(attack2Hitbox, player1);

            // Handle hits and clear attacks after successful hit
            if (player1HitPlayer2 && player2HitPlayer1) {
                // Do nothing if both players would be stunned
                attack1Hitbox = null;
                attack2Hitbox = null;
            } else {
                if (player1HitPlayer2 && !player2.hasHit) {
                    stunAnimate(player2, player1, attackConfigs[player1.currentAttackType]);
                }
                if (player2HitPlayer1 && !player1.hasHit) {
                    stunAnimate(player1, player2, attackConfigs[player2.currentAttackType]);
                }
            }

            // Draw health bars
            drawHealthBar(player1, 20, 20, 200, 20); // Player 1's health bar
            drawHealthBar(player2, canvas.width - 220, 20, 200, 20); // Player 2's health bar

            requestAnimationFrame(animate);
        }


        // draws the attack on the canvas (called at the start of animate)
        function drawAttack(player, attackConfig) {
            const { width: attackWidth, height: attackHeight, offsetX: offsetX, offsetY: offsetY } = attackConfig;

            // Determine attack hitbox position
            const attackX = !player.flipped ? player.x - attackWidth - offsetX : player.x + player.width + offsetX;
            const attackY = player.y + player.height - attackHeight - offsetY;

            ctx.fillStyle = 'rgba(255, 0, 0, 1)';
            ctx.fillRect(attackX, attackY, attackWidth, attackHeight);

            return { x: attackX, y: attackY, width: attackWidth, height: attackHeight };
        }

        // draws player on canvas where they are and facing right direction (called at the end of animate)
        function drawPlayer(player) {
            if (player.flipped) {
                ctx.drawImage(player.image, player.x, player.y, player.width, player.height);
            } else {
                ctx.save();
                ctx.scale(-1, 1);
                ctx.drawImage(player.image, -player.x - player.width, player.y, player.width, player.height);
                ctx.restore();
            }
        }

        // draws health bar
        function drawHealthBar(player, x, y, width, height) {
            const healthPercentage = Math.max(player.health / 100, 0); // Calculate health percentage
            ctx.fillStyle = 'red'; // Background color for health bar
            ctx.fillRect(x, y, width, height);
            ctx.fillStyle = 'green'; // Foreground color for current health
            ctx.fillRect(x, y, width * healthPercentage, height);
            ctx.strokeStyle = 'black'; // Outline color
            ctx.strokeRect(x, y, width, height);
            if (healthPercentage <= 0) {
                gameOver(player)
            }
        }

        function gameOver(loser) {
            if (loser === player1) {
                winner = 'Player2 (borzoi)';
            } else {
                winner = 'Player1 (great dane)';
            }
            document.getElementById('gameOverDiv').style.display = 'block';
            document.getElementById('winnerText').innerHTML = `${winner} Wins`;
        }

        animate();
    </script>
</body>

</html>